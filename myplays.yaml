- name: Executing all Ansible modules
  hosts: localhost
  become: yes

  vars:
    user_group_map:
      raman: amritsar
      ganeev: bengaluru

  tasks:
# Create groups and users
    - name: Create groups
      ansible.builtin.group:
        name: "{{ item.value }}"
        state: present
      loop: "{{ user_group_map | dict2items }}"

    - name: Create users
      ansible.builtin.user:
        name: "{{ item.key }}"
        group: "{{ item.value }}"
        create_home: true
      loop: "{{ user_group_map | dict2items }}"

# Create Cron job
    - name: Script file
      ansible.builtin.copy:
        dest: /tmp/script.sh
        mode: '0755'
        content: |
          Sample Script file for cronjob
        owner: ansible
        group: ansible

    - name: Cron job
      ansible.builtin.cron:
        name: Cronjob for testing
        minute: "30"
        hour: "3"
        day: "*"
        month: "*"
        weekday: "1"
        job: "/tmp/script.sh"
        user: ansible

# Create web page
    - name: Install nginx
      ansible.builtin.package:
        name: "{{ item }}"
        state: present
        update_cache: yes
      loop: 
        - nginx
        - unzip

    - name: Start and enable Nginx
      ansible.builtin.service:
        name: nginx
        state: started
        enabled: yes

    - name: Download Strategic Consulting template
      ansible.builtin.get_url:
        url: https://www.tooplate.com/zip-templates/2149_strategic_consulting.zip
        dest: /tmp/2149_strategic_consulting.zip
        mode: '0644'

    - name: Extract website files
      ansible.builtin.unarchive:
        src: /tmp/2149_strategic_consulting.zip
        dest: /tmp
        remote_src: yes
      notify: Restart Nginx

#    - name: Web Page content
#      ansible.builtin.copy:
#        dest: /var/www/html/index.html
#        content: |
#          Content for Nginx webpage
#        mode: '644'
#      notify: Restart Nginx

  handlers:
    - name: Restart Nginx
      ansible.builtin.service:
        name: nginx
        state: restarted
